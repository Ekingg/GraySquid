{
   "name":"Squid Logs",
   "description":"A pack that can decode squid default log format.",
   "category":"Proxies",
   "inputs":[
      {
         "title":"Squid-Access",
         "configuration":{
            "recv_buffer_size":1048576,
            "tcp_keepalive":false,
            "use_null_delimiter":false,
            "tls_client_auth_cert_file":"",
            "force_rdns":false,
            "bind_address":"0.0.0.0",
            "tls_cert_file":"",
            "store_full_message":false,
            "expand_structured_data":false,
            "port":19302,
            "tls_key_file":"",
            "tls_enable":false,
            "tls_key_password":"",
            "max_message_size":2097152,
            "tls_client_auth":"disabled",
            "override_source":null,
            "allow_override_date":true
         },
         "static_fields":{

         },
         "type":"org.graylog2.inputs.syslog.tcp.SyslogTCPInput",
         "global":false,
         "extractors":[
            {
               "title":"Squid Extractor",
               "type":"GROK",
               "cursor_strategy":"COPY",
               "target_field":"",
               "source_field":"message",
               "configuration":{
                  "grok_pattern":"^%{BASE10NUM:UNWANTED}%{SPACE:UNWANTED}%{INT:Duration;int} %{IPV4:Client_Address} %{DATA:Result_Code;string}\\/%{BASE10NUM:Status_Code;int} %{INT:Bytes;int} %{WORD:Method;string} %{SQUIDURI:URI;string} %{DATA:User;string} %{DATA:Peer_Status;string}\\/%{DATA:Peer_Host;string} %{DATA:Content-Type;string}$",
                  "named_captures_only":false
               },
               "converters":[

               ],
               "condition_type":"NONE",
               "condition_value":"",
               "order":0
            }
         ]
      }
   ],
   "streams":[

   ],
   "outputs":[

   ],
   "dashboards":[
      {
         "title":"Squid TCP_ALLOWED",
         "description":" Squid stats for TCP_ALLOWED",
         "dashboard_widgets":[
            {
               "description":"15min TCP_ALLOWED",
               "type":"SEARCH_RESULT_COUNT",
               "cache_time":10,
               "configuration":{
                  "timerange":{
                     "type":"relative",
                     "range":900
                  },
                  "lower_is_better":false,
                  "trend":true,
                  "query":"application_name:squid\\-access AND NOT Result_Code:TCP_DENIED"
               },
               "col":0,
               "row":0,
               "height":0,
               "width":0
            },
            {
               "description":"15min TCP_ALLOWED bytes",
               "type":"STATS_COUNT",
               "cache_time":10,
               "configuration":{
                  "timerange":{
                     "type":"relative",
                     "range":900
                  },
                  "field":"Bytes",
                  "trend":true,
                  "query":"application_name:squid\\-access AND NOT Result_Code:TCP_DENIED",
                  "stats_function":"sum",
                  "lower_is_better":false
               },
               "col":0,
               "row":0,
               "height":0,
               "width":0
            },
            {
               "description":"15min TCP_ALLOWED Clients",
               "type":"QUICKVALUES",
               "cache_time":10,
               "configuration":{
                  "timerange":{
                     "type":"relative",
                     "range":900
                  },
                  "field":"Client_Address",
                  "show_pie_chart":false,
                  "query":"application_name:squid\\-access AND NOT Result_Code:TCP_DENIED",
                  "show_data_table":true
               },
               "col":0,
               "row":0,
               "height":0,
               "width":0
            },
            {
               "description":"15min TCP_ALLOWED Users",
               "type":"QUICKVALUES",
               "cache_time":10,
               "configuration":{
                  "timerange":{
                     "type":"relative",
                     "range":900
                  },
                  "field":"User",
                  "show_pie_chart":false,
                  "query":"application_name:squid\\-access AND NOT Result_Code:TCP_DENIED",
                  "show_data_table":true
               },
               "col":0,
               "row":0,
               "height":0,
               "width":0
            },
            {
               "description":"15min TCP_ALLOWED Domains",
               "type":"QUICKVALUES",
               "cache_time":10,
               "configuration":{
                  "timerange":{
                     "type":"relative",
                     "range":900
                  },
                  "field":"URI_Host",
                  "show_pie_chart":false,
                  "query":"application_name:squid\\-access AND NOT Result_Code:TCP_DENIED",
                  "show_data_table":true
               },
               "col":0,
               "row":0,
               "height":0,
               "width":0
            }
         ]
      },
      {
         "title":"SquidStats",
         "description":"Statistics for Squid",
         "dashboard_widgets":[
            {
               "description":"15min Requests by Users",
               "type":"QUICKVALUES",
               "cache_time":10,
               "configuration":{
                  "timerange":{
                     "type":"relative",
                     "range":900
                  },
                  "field":"User",
                  "show_pie_chart":false,
                  "query":"application_name:squid\\-access",
                  "show_data_table":true
               },
               "col":2,
               "row":1,
               "height":2,
               "width":1
            },
            {
               "description":"15min Status_Codes",
               "type":"QUICKVALUES",
               "cache_time":10,
               "configuration":{
                  "timerange":{
                     "type":"relative",
                     "range":900
                  },
                  "field":"Status_Code",
                  "show_pie_chart":false,
                  "query":"application_name:squid\\-access",
                  "show_data_table":true
               },
               "col":3,
               "row":3,
               "height":2,
               "width":1
            },
            {
               "description":"15min Result_Code",
               "type":"QUICKVALUES",
               "cache_time":10,
               "configuration":{
                  "timerange":{
                     "type":"relative",
                     "range":900
                  },
                  "field":"Result_Code",
                  "show_pie_chart":false,
                  "query":"application_name:squid\\-access",
                  "show_data_table":true
               },
               "col":3,
               "row":1,
               "height":2,
               "width":1
            },
            {
               "description":"15min Client_Address",
               "type":"QUICKVALUES",
               "cache_time":10,
               "configuration":{
                  "timerange":{
                     "type":"relative",
                     "range":900
                  },
                  "field":"Client_Address",
                  "show_pie_chart":false,
                  "query":"application_name:squid\\-access",
                  "show_data_table":true
               },
               "col":2,
               "row":3,
               "height":2,
               "width":1
            },
            {
               "description":"15min Squid Requests",
               "type":"SEARCH_RESULT_COUNT",
               "cache_time":10,
               "configuration":{
                  "timerange":{
                     "type":"relative",
                     "range":900
                  },
                  "lower_is_better":false,
                  "trend":true,
                  "query":"application_name:squid\\-access"
               },
               "col":1,
               "row":4,
               "height":1,
               "width":1
            },
            {
               "description":"15min Unique Client IP",
               "type":"STATS_COUNT",
               "cache_time":10,
               "configuration":{
                  "timerange":{
                     "type":"relative",
                     "range":900
                  },
                  "field":"Client_Address",
                  "trend":true,
                  "query":"application_name:squid\\-access",
                  "stats_function":"cardinality",
                  "lower_is_better":false
               },
               "col":1,
               "row":3,
               "height":1,
               "width":1
            },
            {
               "description":"15min Cache Bytes",
               "type":"STATS_COUNT",
               "cache_time":10,
               "configuration":{
                  "timerange":{
                     "type":"relative",
                     "range":900
                  },
                  "field":"Bytes",
                  "trend":true,
                  "query":"application_name:squid\\-access AND (Result_Code:TCP_MEM_HIT OR Result_Code:TCP_HIT)",
                  "stats_function":"sum",
                  "lower_is_better":false
               },
               "col":1,
               "row":2,
               "height":1,
               "width":1
            },
            {
               "description":"15min Total Bytes",
               "type":"STATS_COUNT",
               "cache_time":10,
               "configuration":{
                  "timerange":{
                     "type":"relative",
                     "range":900
                  },
                  "field":"Bytes",
                  "trend":true,
                  "query":"application_name:squid\\-access",
                  "stats_function":"sum",
                  "lower_is_better":false
               },
               "col":1,
               "row":1,
               "height":1,
               "width":1
            },
            {
               "description":"15min Top Domains",
               "type":"QUICKVALUES",
               "cache_time":10,
               "configuration":{
                  "timerange":{
                     "type":"relative",
                     "range":900
                  },
                  "field":"URI_Host",
                  "show_pie_chart":false,
                  "query":"application_name:squid\\-access",
                  "show_data_table":true
               },
               "col":4,
               "row":3,
               "height":2,
               "width":1
            },
            {
               "description":"15min Cache Domains",
               "type":"QUICKVALUES",
               "cache_time":10,
               "configuration":{
                  "timerange":{
                     "type":"relative",
                     "range":900
                  },
                  "field":"URI_Host",
                  "show_pie_chart":false,
                  "query":"application_name:squid\\-access AND (Result_Code:TCP_MEM_HIT OR Result_Code:TCP_HIT)",
                  "show_data_table":true
               },
               "col":4,
               "row":1,
               "height":2,
               "width":1
            }
         ]
      },
      {
         "title":"Squid TCP_DENIED Stats",
         "description":"Squid stats for TCP_DENIED ",
         "dashboard_widgets":[
            {
               "description":"15min TCP_DENIED",
               "type":"SEARCH_RESULT_COUNT",
               "cache_time":10,
               "configuration":{
                  "timerange":{
                     "type":"relative",
                     "range":900
                  },
                  "lower_is_better":true,
                  "trend":true,
                  "query":"application_name:squid\\-access AND Result_Code:TCP_DENIED"
               },
               "col":1,
               "row":1,
               "height":1,
               "width":1
            },
            {
               "description":"15min TCP_DENIED Hosts",
               "type":"QUICKVALUES",
               "cache_time":10,
               "configuration":{
                  "timerange":{
                     "type":"relative",
                     "range":900
                  },
                  "field":"Client_Address",
                  "show_pie_chart":false,
                  "query":"application_name:squid\\-access AND Result_Code:TCP_DENIED",
                  "show_data_table":true
               },
               "col":3,
               "row":1,
               "height":2,
               "width":1
            },
            {
               "description":"15min TCP_DENIED Domains",
               "type":"QUICKVALUES",
               "cache_time":10,
               "configuration":{
                  "timerange":{
                     "type":"relative",
                     "range":900
                  },
                  "field":"URI_Host",
                  "show_pie_chart":false,
                  "query":"application_name:squid\\-access AND Result_Code:TCP_DENIED",
                  "show_data_table":true
               },
               "col":2,
               "row":1,
               "height":2,
               "width":1
            },
            {
               "description":"15min TCP_DENIED Users",
               "type":"QUICKVALUES",
               "cache_time":10,
               "configuration":{
                  "timerange":{
                     "type":"relative",
                     "range":900
                  },
                  "field":"User",
                  "show_pie_chart":false,
                  "query":"application_name:squid\\-access AND Result_Code:TCP_DENIED",
                  "show_data_table":true
               },
               "col":2,
               "row":3,
               "height":2,
               "width":1
            }
         ]
      }
   ],
   "grok_patterns":[
      {
         "name":"SQUIDURI",
         "pattern":"(?:%{SQUIDURIPROTO:URI_Protocol;string}:\\/\\/|)(?:%{SQUIDURIUSER:URI_User;string}@|)%{SQUIDURIHOST:URI_Host;string}(?:\\:%{SQUIDURIPORT:URI_Port;int}|)(?:\\/%{SQUIDURIPATH:URI_Path;string}|)(?:#%{SQUIDURIFRAG:URI_Frag;string}|)"
      },
      {
         "name":"SQUIDURIUSER",
         "pattern":"([a-z0-9-._~!$&'()*+,;=:]+)"
      },
      {
         "name":"SQUIDURIFRAG",
         "pattern":"([a-z0-9-._~!$&'()*+,;=:]+)"
      },
      {
         "name":"SQUIDURIPATH",
         "pattern":"([a-zA-Z0-9-._~!$&'()*+,;=:\\/%?]+)"
      },
      {
         "name":"SQUIDCONTENTTYPE",
         "pattern":"([-\\w]{1,127}\\/[-\\w]{1,127})|(-)"
      },
      {
         "name":"SQUIDURIHOST",
         "pattern":"([a-z0-9-._~!$&'()*+,;=]+)"
      },
      {
         "name":"SQUIDURIPORT",
         "pattern":"([\\d]+)"
      },
      {
         "name":"SQUIDURIPROTO",
         "pattern":"([a-z]+)"
      }
   ]
}